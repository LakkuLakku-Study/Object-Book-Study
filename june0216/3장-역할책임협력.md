- 이전 장에서 구현 측면에서 객체지향을 다뤘다.
    - 클래스, 추상클래스, 인터페이스를 조합해서 객체지향을 구조화하는 기본적인 방법 + 상속을 통해 다형성을 구현하는 기법 + 지연 바인딩에 대해 다룸
- 객체지향 패러다임의 핵심
    - 역할, 책임, 협력이다.
    - **협력을 구성하기 위해 적절한 객체를 찾고 적절한 책임을 할당**하는 과정에서 객체지향의 핵심이 드러난다.
    - 구현 이전에 우선적으로 이러한 과정을 거치지 않는다면 유연하지 못한 코드가 된다.

# 1) 협력

## 영화 시스템

- 영화 예매를 위해 다양한 객체들이 협력을 구축한다.
- 애플리케이션의 제어 흐름은 하나의 객체에 의해 통제되는 것이 아니라 다양한 객체들 사이에서 “균형있게” 분배된다.
- 이를 위해 메시지를 주고 받으면서 상호작용한다.
    - 이러한 상호작용 == “협력”
    - 협력에 참여하기 위해 수행하는 로직 == “책임”

## 협력

- 협력 → 어떤 객체가 다른 객체에게 무엇인가 요청하는 것이다.
    - 두 객체가 상호작용을 통해 더 큰 책임을 수행한다.
    - 객체는 다른 객체와 협력하는 존재
    - 협력은 객체지향의 세계에서 기능을 구현할 수 있는 “유일한 방법”이다.
- 객체들 사이의 협력을 구성하는 일련의 요청과 응답의 흐름을 통해 애플리케이션의 기능이 구현된다.
    - 자신에게 할당한 책임을 수행하는 중에 외부의 도움이 필요한 경우 다른 객체에게 협력을 요청한다.

- **메시지 전송**은 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단
    - 왜냐하면 객체는 다른 객체의 내부 구현에 접근할 수 없기 때문에 메세지 전송을 통해서만 **자신의 요청을 전달**할 수 있다.
- **메시지를 수신**한 객체는 메서드를 실행해 요청에 응답한다
    - 객체가 요청을 받으면 이 메시지를 처리할 방법을 “스스로 선택”한다. (자율적인 존재)
- 각자 객체가 잘하는 일을 믿고 맡긴다.
    - 협력에 참여하는 전체적인 자율성을 향상시킬 수 있다.
    - 만약 내부 구현에 관여한다면 수동적인 존재가 된다.
- 자율적인 존재로 만들기 위해 → “캡슐화”한다.
    - 캡슐화를 통해 변경에 대한 파급 효과를 제한할 수 있기 때문에 변경하기도 쉬워진다.

## 협력이 설계를 위한 문맥을 결정한다.

- 객체 지향은 객체를 중심에 놓는 프로그래밍 패러다임이다.
    - 객체 == 상태와 행동을 함께 캡슐화하는 실행 단위
- 객체가 존재하는 이유 → “협력에 필요한 적절한 행동을 보유”하고 있기 때문에
- 객체의 행동을 결정하는 것 → 협력
    - 협력에서 어떠한 책임(역할)을 맡고 있는지가 행동이다.
    - ex) Movie 객체는 영화 예매하기 위한 협력에 참여하고 있고 요금을 계산하는 책임을 가지고 있다.
    
- 객체의 상태를 결정하는 것 → 행동
    - 행동을 수행하는 데 필요한 정보
    - 객체는 자율적인 존재이기 때문에 행동을 수행하기 위해서 필요한 정보도 함께 가지고 있어야 한다.
    - ex) Movie가 요금을 계산하는 행동을 하기 위해 기본 요금 fee와 할인 정책 discountPolicy 정보가 필요하다.
- 결과적으로, 객체가 참여하는 협력이 객체를 구성하는 행동과 상태를 모두 결정한다.
    - → 협력은 객체를 설계하는 데 필요한 문맥을 제공한다.

# 2) 책임

- 협력이 다 갖춰지면 → 협력에 필요한 행동을 수행할 수 있는 적절한 객체를 찾는 것이다.
- 책임
    - 협력에 참여하기 위해 객체가 수행하는 행동
    - 객체가 유지해야 하는 정보와 수행할 수 있는 행동에 대해 개략적으로 서술한 문장
    - 책임 = (1) 무엇을 알고 있는가 doing + (2) 무엇을 할 수 있는가 knowing
- 하는 것
    - 객체를 생성하거나 계산을 수행하는 등의 스스로 하는 것
    - 다른 객체의 행동을 시작시키는 것
    - 다른 객체의 활동을 제어하고 조절하는 것
- 아는 것
    - 사적인 정보에 관해 아는 것
    - 관련된 객체에 관해 아는 것
    - 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것

- Screening
    - 하는 것 - 영화를 예매할 수 있어야 한다.
    - 아는 것 - 자신이 상영할 영화를 알고 있어야 한다.

- 영화 예매 시스템을 구성하는 역할과 책임
    - CRC 카드 (Candidate, Responsibility, Collaborator)
    
    ![스크린샷 2024-09-03 오후 2.36.27(2).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2c6ccd4-4439-43db-96e9-e654aaf4aa71/1a1c375d-67e2-490d-b87e-ebed7616a577/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-09-03_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.36.27(2).png)
    
    Candidate - 협력에 참여하는 하나의 후보 (ex) Screening 
    
    Responsibility - 무엇을 해야하는지 책임 (ex) 예매 정보를 생성한다. 
    
    Collaborator - 책임을 수행하면서 함께 협력할 협력자들 (ex) Screening에서 Movie
    
- 협력 안에서 객체에게 할당한 책임이 외부의 인터페이스와 내부의 속성을 결정한다.
    - Screening이 영화를 예매할 책임을 수행 → reserve 메시지를 수신하고 movie를 인스턴스 변수로 포함함
- 책임의 크기 > 메시지의 크기
    - 책임 → 객체가 수행할 수 있는 행동을 종합적이고 간략하게 서술 → 추상적이고 개념적으로 더 크다.
    - 객체는 책임을 수행하기 위해 필요한 정보를 알아야 하고 + 자신을 도와줄 객체를 알아야 한다.
    - → 객체에게 책임을 할당하기 위한 가장 기본적인 원칙에 대한 힌트를 제공한다.
- **객체지향 설계에서 가장 중요한 것은 책임**
    - 적절한 책임을 할당해야만 유연한 설계를 창조 가능

## 책임 할당

- 자율적인 객체를 만드는 가장 기본적인 방법
    - 책임을 수행하는 데 필요한 정보를 가장 잘 알고 있는 전문가에게 그 책임을 할당
    - = INFORMATION EXPERT(정보 전문가) 패턴

- 객체에게 책임을 할당하기 위해서는 먼저 협력이라는 문맥을 정의해야한다.
    - 일단 시스템이 담당할 하나의 책임으로 시작하여 시스템의 책임을 완료하는 데 필요한 더 작은 책임을 찾아내고 이를 객체들에게 할당하는 반복적인 과정을 통해 갖춰간다.
- 과정
    - 영화 예매 시스템의 기능 → 영화를 예매하는 것 → 이를 시스템이 제공해야할 책임
        - (1) 책임을 수행하게 하는 유일한 방법 ⇒ 메시지 전송
            - 예매라는 이름의 메시지로 **협력을 시작**
        - (2) 정보 전문가에게 “예매하라” **메시지를 처리**하도록 한다.
            - 예매를 처리하기 위해서 상영 시간과 기본 요금에 대해서 알아야 한다.
            - 이를 잘 알고 있는 전문가는 Screening 객체이다.
        - (3) 예매를 하기 위해서는 예매 가격을 계산해야한다.
            - Screening은 단순히 영화 기본 요금에 대해서만 알고 있지 가격 자체에 대해서는 정보 전문가가 아니므로 또 다른 적절한 객체에게 계산 책임을 수행하게 한다.
            - “가격을 계산하라”라는 메시지로 **협력 시작**
        - (4) 정보 전문가에게 “가격 계산” **메시지를 처리**하도록 한다.
            - 가격을 계산하는 데 필요한 정보를 많이 알고 있는 Movie에게 계산 책임을 할당한다.
        - (5) 가격에는 할인 정책이 포함된다.
            - 또 다른 적절한 객체에게 할인요금을 계산하는 책임을 수행하게 해야한다.
            - “할인 요금을 계산하라”라는 새로운 메시지로 협력 시작
- 이렇게 정보 전문가에게 책임을 할당하는 반복적인 과정을 통해 설계가 이루어진다.
    - 결과물은 시스템을 구성하는 객체들의 인터페이스와 오퍼레이션 목록이다.
    - 그리고 이를 통해 앞서 배운 구현 방법을 적용하여 코드로 구현하면 된다.

## 책임 주도 설계

- 설계할 때 책임에 초점을 맞추어 어떤 책임을 선택하느냐가 전체적인 설계의 방향과 흐름을 결정한다.
    - 이를 책임 주도 설계라고 한다.
- 책임 주도 설계 과정
    - (1) 시스템이 사용자에게 제공해야하는 기능인 시스템 책임을 파악한다.
    - (2) 시스템 책임을 더 작은 책임으로 분할한다.
    - (3) 분할된 책임을 수행할 수 있는 적절한 객체 또는 역할을 찾아 책임을 할당한다.
    - (4) 객체가 책임을 수행하는 도중 다른 객체의 도움이 필요한 경우 이를 책임질 적절한 객체 또는 역할을 찾는다.
    - (5) 해당 객체 또는 역할에게 책임을 할당함으로써 두 객체가 협력하게 한다.
- 이는 구현이 아닌 책임에 집중할 수 있다.

- 책임을 할당할 때 고려해야하는 요소 2가지
    1. 메시지가 객체를 결정한다. 
    2. 행동이 상태를 결정한다. 

### 1) 메시지가 객체를 결정한다.

- 책임을 할당할 때 객체를 먼저 x , 메시지를 먼저 식별하고 메시지를 처리할 객체를 나중에 선택함
- 메시지가 객체를 선택하게 하는 이유 2가지
    - (1) 객체가 최소산의 인터페이스를 가질 수 있게 된다.
        - 필요한 메시지가 식별될 때까지 **객체의 퍼블릭 인터페이스에 어떤 것도 추가하지 않기 때문에** 객체는 애플리케이션에 크지도, 작지도 않은 꼭 필요한 크기의 퍼블릭 인터페이스를 가질 수 있다.
    - (2) 객체는 충분히 추상적인 인터페이스를 가질 수 있게 된다.
        - 객체의 인터페이스는 무엇을 하는지는 표현해야 하지만 어떻게 수행하는지를 노출해서는 안 된다.
            - 메시지는 외부의 객체가 요청하는 무언가를 의미함 → 메시지를 먼저 식별하면 **무엇을 수행할지에 초점을 맞추는 인터페이스**를 얻을 수 있다.

### 2) 행동이 상태를 결정한다.

- 객체가 존재하는 이유는 협력에 참여하기 위해서이다.
    - → 객체는 협력에 필요한 행동을 제공해야한다.
    - → 객체답게 만드는 것은 객체의 상태 ❌ 객체가 다른 객체에게 제공하는 행동 ⭕
    - 객체의 행동은 객체가 협력에 참여할 수 있는 “유일한 방법”이므로 객체의 상태가 아닌 행동에 따라 → 적절한 책임이 할당되었는지, 협력에 얼마나 적절한지가 갈린다.
    
- 보통 상태에 초점을 맞추고 상태에 필요한 행동을 결정하는데 이러면 내부 구현이 객체의 퍼블릭 인터페이스에 노출이 되기 때문에 캡슐화를 저해한다.
    - 이를 데이터 주도 설계라고 한다.
- 캡슐화를 위반하지 않도록 구현에 대한 결정을 뒤로 미루면서 **객체의 행위를 고려하기 위해 항상 “협력”이라는 문맥 안에서 객체를 생각**해야한다.
    - 협력 관계 속에서 다른 객체에게 무엇을 제공해야하고 다른 객체로부터 무엇을 얻어야 하는지를 고민해야만 훌륭한 책임 수확이 가능하다.
- 행동이 상태보다 중요하다.✨
    - 상태는 행동을 결정하고 나서 비로소 결정할 수 있는 것이다.
    - 협력이 → 객체의 행동을 결정하고 → 행동이 상태를 결정한다.
    - 행동이 바로 객체의 책임이 된다.

# 3) 역할

## 역할과 협력

- 객체는 협력의 문맥 안에서 특정한 목적을 갖는다.
- 목적 == 책임의 집합 == 역할
- 협력을 모델링할 때는 특정한 객체가 아니라 역할에게 책임을 할당한다고 생각하는 게 좋다.
- “예매하라” 메시지를 처리할 객체 선택(책임 할당 과정은 독립적인 2가지 과정으로 이뤄짐)
    - (1) 영화를 예매할 수 있는 적절한 역할이 무엇인가
    - (2) 역할을 수행할 객체로 Screening 인스턴스를 선택
    - 역할에 특별한 이름을 부여하지 않았지만 실제로 **익명의 역할(객체를 수용할 수 있는 위치임)**을 찾고 → 그 역할을 수행할 수 있는 객체를 선택하는 방식으로 설계
- 왜 역할이라는 개념이 있어야하는가? 객체만으로 협력을 설계할 수 있는 거 아님?

## 유연하고 재사용 가능한 협력

- 역할이 중요한 이유
    - 유연하고 재사용 가능한 협력을 얻을 수 있음!!
- 만약 역할 개념을 고려하지 않고 바로 객체에게 책임을 할당한다면?
    - Movie 객체가 가격을 계산하기 위해 할인 요금이 필요하므로 외부 객체에게 “할인 요금 계산”이라는 메시지를 전송하여 외부 객체에게 도움을 요청한다.
        
        ![스크린샷 2024-09-03 오후 5.17.19(2).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2c6ccd4-4439-43db-96e9-e654aaf4aa71/2ed24588-f066-41f5-926d-838b83aa1177/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-09-03_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.17.19(2).png)
        
    - 이때, 2가지 할인 정책(AmountDiscountPolicy와 PercentDiscountPolicy)이 존재하므로 각각의 인스턴스가 “할인 요금 계산”메시지에 응답할 수 있어야 한다.
    - 하지만 2가지 객체가 참여하는 협력을 개별적으로 만든다면 코드가 중복된다.
        
        ![스크린샷 2024-09-03 오후 5.17.34(2).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2c6ccd4-4439-43db-96e9-e654aaf4aa71/febdea6d-70bb-4290-aa5b-f8388bd60ca1/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-09-03_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.17.34(2).png)
        
    - 따라서 객체가 아닌 “책임”에 초점을 맞춰야한다.
        - 알고보면 2가지 객체인 AmountDiscountPolicy와 PercentDiscountPolicy 모두 동일한 책임(할인 요금 계산)을 수행한다.
        - 이 두 가지 객체를 동일한 책임을 수행하는 역할을 기반으로 두 개의 협력을 하나로 통합하여 중복을 제거할 수 있다.
            - 대표자는 교대로 바꿔 낄 수 있는 슬롯이라고 생각할 수 있으며 이것이 역할이다.
            
            ![스크린샷 2024-09-03 오후 5.24.06(2).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2c6ccd4-4439-43db-96e9-e654aaf4aa71/62265d03-3f66-4ca8-a324-aa445cad0d8c/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-09-03_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.24.06(2).png)
            
        - 두 종류의 구체적인 객체를 포괄하는 추상화하므로 이를 포괄할 수 있는 추상적인 이름을 부여할 수 있다.
            - AmountDiscountPolicy와 PercentDiscountPolicy → (추상화) → DiscountPolicy
        - 중복 제거 효과뿐만 아니라 더 유연해졌다.
            - 새로운 할인 정책을 추가하기 위해 새로운 협력을 추가할 필요가 없어짐
        - 따라서, 책임과 역할을 중심으로 협력을 바라보는 것이 변경과 확장이 용이한 유연한 설계로 나아가는 첫걸음이다.
- 역할을 구현하는 방법
    - 추상 클래스, 인터페이스
    - 책임의 집합을 서술한 것이다.
    - 공통 구현이 필요하다면 책임의 일부를 구현한 → 추상클래스
    - 공통 구현이 필요없고 책임의 집합만 나열해놓고 싶다면 → 인터페이스

## 객체 대 역할

- 역할 == 객체가 참여할 수 있는 일종의 슬롯
- 하지만 오직 한 종류의 객체만 협력에 참여하는 상황에서 역할이라는 개념을 고려하는 것이 유용할까?
    - 이때는 객체로 간주하고(하나의 역할을 하므로 추상화된 것과 실제 객체는 동일한 것으로 간주) 여러 종류가 있어 슬롯의 역할을 한다면 이때는 역할이라고 부르면 된다.
- 협력, 역할, 객체, 클래스의 관계
    - 협력은 역할들의 `상호작용으로 구성`되고
    - 협력을 구성하기 위해 역할에 적합한 객체가 `선택되며`
    - 객체는 클래스를 이용해 `구현되고 생성된다.`

![스크린샷 2024-09-03 오후 5.32.53(2).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2c6ccd4-4439-43db-96e9-e654aaf4aa71/6b5b22ba-0e35-47e8-a3c4-66f8bd28b598/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-09-03_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.32.53(2).png)

- 대부분의 경우 어떤 것이 역할이고 어떤 것이 객체인지 명확하게 드러나지 않을 것이다.
    - 한 번에 명확하게 구분하려고 하지 말고 반복적으로 책임과 협력을 정제하는 과정을 통해 점차적으로 객체로부터 역할을 분리해내는 것이 좋은 방법이다.
    - 이때 명확하게 구분하는 것보다 중요한 것은 어떤 책임이 필요한지를 이해하는 것이다.
    - 다양한 객체들이 협력에 참여한다는 것이 확실하면 역할로 시작하라
        - 하지만 모든 것이 불확실할 때는 구체적인 객체로 시작하라
- 역할 모델링
    - 상호작용하는 객체들의 협력 패턴을 역할들 사이의 협력 패턴으로 추상화하여 유연하고 재사용 가능한 시스템을 얻을 수 있는 방법에 관해 잘 설명하고 있다.

## 역할과 추상화

- 위에서 추상화의 장점 2가지를 이야기했는데 이는 협력의 관점에서 역할에도 동일하게 적용할 수 있다.
- 장점 1) 세부 사항에 억눌리지 않고 상위 수준의 정책을 쉽고 간단하게 표현 가능
    - 불필요한 세부 사항을 생략하고 핵심적인 개념을 강조할 수 있다.
    - 객체 사이의 핵심적인 상호작용이 좀 더 또렷하게 드러난다.
        - 할인 정책과 할인 조건에 상관없이 그냥 할인 정책과 할인 조건이 서로 어떻게 협력하는지 간단하게 나타낼 수 있다.
            
            ![스크린샷 2024-09-03 오후 5.46.04(2).png](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2c6ccd4-4439-43db-96e9-e654aaf4aa71/36d92e60-17b8-48ed-a9fc-aaa425551ad1/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2024-09-03_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.46.04(2).png)
            
        - DiscountPolicy와 DiscountCondition의 인스턴스를 조합해야한다.
        - DiscountPolicy가 DiscountCondition에게 메시지를 전송하며 협력한다.
- 장점 2) 설계를 유연하게 만들 수 있다.
    - 역할은 다양한 종류의 객체를 끼워넣을 수 있으므로 서로 대체가 가능하다.
    - 수정하지 않고도 새로운 행동을 추가할 수 있으므로 협력을 유연하게 한다.

### 배우 배역  은유

- 배역- 역할
    - 서로 다른 배우들이 같은 배역을 맡을 수 있다.
    - 객체가 협력에 참여하는 잠시 동안에만 존재하는 일시적인 개념
    - 역할은 객체의 페르소나
- 배우 - 객체
- 협력 - 연극
- 코드 - 극본
